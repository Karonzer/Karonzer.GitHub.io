<krpano>

<!-- 미니맵 아이콘 스타일-->
	<style name="minimapclose"  keep="true" url="%FIRSTXML%/source/common/minimap/minimap_close.png" type="image" zorder="12"  align="lefttop" edge="center" handcursor="true"/>
	
	<Style name="mapactivespot" keep="true" url="%FIRSTXML%/source/common/minimap/marker_actived.png" zorder="11" align="center" edge="center" handcursor="false" visible = "false"/>
	<Style name="airactivespot" keep="true" url="%FIRSTXML%/source/common/minimap/air_marker_actived.png" zorder="11" align="center" edge="center" handcursor="false" />
	<Style name="minitivespot" keep="true" url="%FIRSTXML%/source/common/minimap/minimarker.png" zorder="11" align="center" edge="center" handcursor="false" />
	
	<style name="mapspot" keep="true" url="%FIRSTXML%/source/common/minimap/marker.png" zorder="10" align="lefttop" edge="bottom"  handcursor="true" />
	<style name="minimapspot" keep="true" url="%FIRSTXML%/source/common/minimap/minimarker.png" zorder="10" align="lefttop" edge="bottom"  handcursor="true" />
	<Style name="airactivespot" keep="true" url="%FIRSTXML%/source/common/minimap/air_marker_actived.png" zorder="11" align="center" edge="center" handcursor="false" />
	<style name="airspot" keep="true" url="%FIRSTXML%/source/common/minimap/air_marker.png" zorder="10" align="lefttop" edge="bottom"  handcursor="true" />
	<style name="exitspot" keep="true" url="%FIRSTXML%/source/common/minimap/btn_out.png" zorder="10" align="lefttop" edge="bottom"  handcursor="true" />

	<style name="mapspot2" keep="true" url="%FIRSTXML%/source/common/minimap/minimarker.png" zorder="10" align="lefttop" edge="bottom"  handcursor="true" />
	
<!-- Radar -->
<layer name="radar" keep="true"
       url.flash="%FIRSTXML%/plugins/radar.swf"
       url.html5="%FIRSTXML%/plugins/radar.js"
       align="center" zorder="10"
     scale="1"
       fillalpha="0.5" fillcolor="0x7F5F3F"
       linewidth="1.0" linecolor="0xE0E0A0" linealpha="0.5" alpha="0.0" handcursor="false" capture="false" enabled="false"
       />

	<layer name="activespot" style="mapactivespot" visible ="false" />
	<layer name="activeminispot" style="minitivespot" visible ="false"/>
	<layer name="activeairspot" style="airactivespot" visible ="false"/>

	<!-- 미니맵 열기(토글 방식) -->
	<!-- 0601수정_ 미니맵 현재 상태 저장함. -->	
	<action name="open_close_minimap">
		if(layer[get(minimap)].visible == true,
      set(minimap_status, false);
			tween(layer[get(minimap)].alpha, 0.0);
			delayedcall(0.5, set(layer[get(minimap)].visible, false));
			, set(layer[get(minimap)].visible, true);
      set(minimap_status, true);
			tween(layer[get(minimap)].alpha, 1.0);
		);
	</action>

	<!-- close minimap -->
	<action name="close_minimap">
	set(layer[get(minimap)].alpha, 0.0);
	set(layer[get(minimap)].visible, false);
	</action>

	<!-- 창 크기 변경 시 미니맵 사이즈 계산,  -->
	<!-- 0601수정_ 실내 미니맵인 경우 세로 기준으로 리사이즈하도록 수정함. 1차 프로젝트 유적지 미니맵 비율 추가 및 2차 프로젝트 유적지 미니맵 비율 수정함. -->	
	<action name="minimap_size">
		if(minimap_inside,
		set(heightratio, 0.18);
		calc(imgratio, layer[get(minimap)].width/layer[get(minimap)].height);
		calc(layer[get(minimap)].height, stageheight * heightratio);
		calc(layer[get(minimap)].width, layer[get(minimap)].height * imgratio);,
		if(
		currentscene === "ty_hsd",set(widthratio, 0.70);set(heightratio, 0.50);,
		);
		calc(imgratio, layer[get(minimap)].width/layer[get(minimap)].height);
		if( stagewidth/stageheight GE 1,
		calc(layer[get(minimap)].height, stageheight * heightratio);
		calc(layer[get(minimap)].width, layer[get(minimap)].height * imgratio);
		, calc(layer[get(minimap)].width, stagewidth * widthratio);
		calc(layer[get(minimap)].height, layer[get(minimap)].width / imgratio);
		);
		);
	</action>
	
	<action name ="minimapBtn_size">
		
	</action>


	<!-- 미니맵 클릭으로 노드 이동 / 블렌드 효과, 미니맵 사라졌다 나타나는 효과 -->
	<action name="goto_by_minimap">
		loadscene(%1, null, MERGE, BLEND(1));
		vrmode_btn_description();
		set(layer[CirclesControlBar_menu_bg].visible, true);
		tween(layer[CirclesControlBar_menu_bg].alpha, 1.0, 1);
	</action>

	<action name="updateAirSpot">
		set(layer[activespot].visible, false);
		set(layer[activeairspot].visible, true);
		set(layer[activeairspot].parent, %1);
		set(layer[radar].visible, false);
		tween(layer[radar].alpha, 0.0);
		set(layer[radar].parent, %1);
		set(layer[radar].heading, %2);
		delayedcall(0.3, set(layer[radar].visible, true);	tween(layer[radar].alpha, 1.0, 0.3); );
		
	</action>
	
	<!-- active hotspot position, radar direction, in air or not -->
	<action name="updateminimap">
		if(%3,
		set(layer[activespot].visible, false);
		set(layer[activeminispot].visible, true);
		set(layer[activeminispot].parent, %1);
		,
		set(layer[activespot].visible, true);
		set(layer[activeminispot].visible, false);
		set(layer[activespot].parent, %1);
		);
		set(layer[activeairspot].visible, false);
		set(layer[radar].visible, false);
		tween(layer[radar].alpha, 0.0);
		set(layer[radar].parent, %1);
		set(layer[radar].heading, %2);
		delayedcall(0.3, set(layer[radar].visible, true);	tween(layer[radar].alpha, 1.0, 0.3); );

	</action>

  <!-- active hotspot position-->
  <action name="update_inside_minimap">
    set(layer[activespot].visible, true);
    set(layer[activeairspot].visible, false);
    set(layer[activespot].parent, %1);
    set(layer[radar].visible, false);
    tween(layer[radar].alpha, 0.0);
  </action>

  <action name = "goto_inside">
    Playeffect("walking");
    set(layer[get(minimap)].alpha, 0.0);
    set(layer[get(minimap)].visible, false);

    set(minimap, calc: "%1" + "_minimap");
    set(layer[activespot].parent, get(minimap));
    ifnot(vrmode_on,
    set(layer[get(minimap)].visible, true);
    tween(layer[get(minimap)].alpha, 1.0);
    );
	<!-- 0601수정_ 실내 미니맵 상태 저장, 정의되지 않은 함수 삭제함(inside_minimap, 확인 필요). -->
    set(minimap_inside, true);
    loadscene(%2, null, MERGE, OPENBLEND(1.8, 0.0, 0.3, 0.7, easeOutQuad));

    vrmode_btn_description();
  </action>

  <action name = "goto_outside">
    Playeffect("walking");
    set(layer[get(minimap)].alpha, 0.0);
    set(layer[get(minimap)].visible, false);

    set(minimap, calc: currentscene + "_minimap");
		set(layer[activespot].parent, get(minimap));

	<!-- 0601수정_ 실내 지도에서 나갈 때 기존 미니맵 상태에 따라 미니맵 표시함. -->
    ifnot(vrmode_on,
      if(minimap_status ,
        set(layer[get(minimap)].visible, true);
        tween(layer[get(minimap)].alpha, 1.0);
      );
    );
    set(minimap_inside, false);
    loadscene(%1, null, MERGE, OPENBLEND(1.8, 0.0, 0.3, 0.7, easeOutQuad));

  </action>

	<!-- 미니맵 아이콘 위치 -->
	<layer name="ty_hsd_minimap" url="%FIRSTXML%/source/ty_hsd/minimap/ty_hsd_minimap.png" width="932" height="687" onloaded="minimap_size();" keep="true" handcursor="false" capture="true" x="-0" y="20" scale="1" scalechildren="true" align="rightbottom" zorder="10" alpha="0.0" visible = "false"/>

	<layer name="ty_hsd_minimap_close" style="minimapclose" x="1150" y="125" onclick="open_close_minimap();" parent="ty_hsd_minimap" />
	<!-- 한산문 -->
	<layer name="ty_hsd_spot1" style="mapspot" x="410" y="830" onclick="goto_by_minimap(ty_hsd_1);"  parent = "ty_hsd_minimap"/>
	<!-- 제승당 가는 길 -->
	<layer name="ty_hsd_spot2" style="mapspot" x="530" y="640" onclick="goto_by_minimap(ty_hsd_2);"  parent = "ty_hsd_minimap"/>
	<!-- 대첩문 -->
	<layer name="ty_hsd_spot3" style="mapspot" x="600" y="275" onclick="goto_by_minimap(ty_hsd_3);"  parent = "ty_hsd_minimap"/>
	<!-- 충무문 -->
	<layer name="ty_hsd_spot4" style="mapspot" x="834" y="612" onclick="goto_by_minimap(ty_hsd_4);"  parent = "ty_hsd_minimap"/>
	<!-- 제승당 -->
	<layer name="ty_hsd_spot5" style="mapspot" x="946" y="600" onclick="goto_by_minimap(ty_hsd_5);"  parent = "ty_hsd_minimap"/>
	<!-- 제승당 공허비 -->
	<layer name="ty_hsd_spot6" style="mapspot" x="886" y="672" onclick="goto_by_minimap(ty_hsd_6);"  parent = "ty_hsd_minimap"/>
	<!-- 수루 -->
	<layer name="ty_hsd_spot7" style="mapspot" x="949" y="697" onclick="goto_by_minimap(ty_hsd_7);"  parent = "ty_hsd_minimap"/>
	<!-- 한산정 -->
	<layer name="ty_hsd_spot8" style="mapspot" x="1081" y="555" onclick="goto_by_minimap(ty_hsd_8);"  parent = "ty_hsd_minimap"/>
	<!-- 제승당 유허비 -->
	<layer name="ty_hsd_spot9" style="mapspot" x="917" y="345" onclick="goto_by_minimap(ty_hsd_9);"  parent = "ty_hsd_minimap"/>
	<!-- 충무사 -->
	<layer name="ty_hsd_spot10" style="minimapspot" x="904" y="259" onclick="goto_by_minimap(ty_hsd_10);"  parent = "ty_hsd_minimap"/>
	<!-- 항공뷰 -->
	<layer name="ty_hsd_spot15" style="airspot" x="781" y="842" onclick="goto_by_minimap(ty_hsd_15);"  parent = "ty_hsd_minimap"/>
	<!-- 한산대첩 항공뷰 -->
	<layer name="ty_hsd_spot16" style="airspot" x="660" y="925" onclick="goto_by_minimap(ty_hsd_16);"  parent = "ty_hsd_minimap"/>
	<!-- 17 -->
	<layer name="ty_hsd_spot17" style="minimapspot" x="337" y="569" onclick="goto_by_minimap(ty_hsd_17);"  parent = "ty_hsd_minimap"/>
	<!-- 18 -->
	<layer name="ty_hsd_spot18" style="minimapspot" x="947" y="641" onclick="goto_by_minimap(ty_hsd_18);"  parent = "ty_hsd_minimap"/>
	<!-- 19 -->
	<layer name="ty_hsd_spot19" style="minimapspot" x="935" y="514" onclick="goto_by_minimap(ty_hsd_19);"  parent = "ty_hsd_minimap"/>
	<!-- 20 -->
	<layer name="ty_hsd_spot20" style="minimapspot" x="927" y="452" onclick="goto_by_minimap(ty_hsd_20);"  parent = "ty_hsd_minimap"/>
	<!-- 제승당 내부 -->
	<!--<layer name="ty_hsd_spot11" style="mapspot" x="0" y="0" onclick="goto_by_minimap(ty_hsd_11);"  parent = "ty_hsd_minimap"/>	-->
	<!-- 수루 내부 -->
	<!--<layer name="ty_hsd_spot12" style="mapspot" x="0" y="0" onclick="goto_by_minimap(ty_hsd_12);"  parent = "ty_hsd_minimap"/>	-->
	<!-- 한산정 내부 -->
	<!--<layer name="ty_hsd_spot13" style="mapspot" x="0" y="0" onclick="goto_by_minimap(ty_hsd_13);"  parent = "ty_hsd_minimap"/>	-->
	<!-- 충무사 내부 -->
	<layer name="ty_hsd_spot14" style="mapspot" x="902" y="215" onclick="goto_by_minimap(ty_hsd_14);"  parent = "ty_hsd_minimap"/>

	
</krpano>
