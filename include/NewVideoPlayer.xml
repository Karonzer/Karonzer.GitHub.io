<krpano >

	<!-- background  -->
	<style name="bg_video_frame" type="container" alpha="0" keep="true" align="lefttop"  width="100%" height="100%" zorder="50" safearea="false"
		   bgcolor="0x000000"  bgalpha="0.7" bgcapture="true" handcursor="false" onclick="" />

	<action name="videoplayer_open">
		if(layer[bg_video_frame],
			<!-- error -->
			trace('videoplayer_open - there is already a videoplayer!'-);
		  ,
			<!-- step one - add a background layer and fade it in -->

			set(width_vsm,1); <!-- 비디오 넓이 -->
			set(height_vsm,1); <!-- 비디오 높이 -->

			addlayer(bg_video_frame);
			layer[bg_video_frame].loadstyle(bg_video_frame);

			set(layer[bg_video_frame].onclick, videoplayer_close_video(););
			tween(layer[bg_video_frame].alpha, 1.0, 0.5, default,
				<!-- step two - after the fade-in add the videoplayer plugin -->
				addlayer(videoplayer_video);
				set(layer[videoplayer_video].parent, layer[bg_video_frame]);
				set(layer[videoplayer_video].align, center);
				set(layer[videoplayer_video].loop, false);
				set(layer[videoplayer_video].onclick, togglepause();  position_slider_vid_addhs(); );

				set(layer[videoplayer_video].onover, tween(layer[blok_GV].height,30,0.2); tween(layer[blok_GV].alpha,1,0.2); );
				set(layer[videoplayer_video].onout,  tween(layer[blok_GV].height,3,0.2); tween(layer[blok_GV].alpha,0,0.2); );
				set(layer[videoplayer_video].ondown,  );
				set(layer[videoplayer_video].onup, );


				set(layer[videoplayer_video].alpha, 0.0);
				set(layer[videoplayer_video].scale, 0.0);
				set(layer[videoplayer_video].onloaded, videoplayer_ready_video(%1); );	<!-- 비디오 로드 -->
				set(layer[videoplayer_video].volume, 0.5);	<!-- 볼륨 -->
					set(layer[videoplayer_video].onvideocomplete, videoplayer_close_video();); <!-- 비디오 완료시 비디오 닫기 -->

				<!-- set(layer[videoplayer_video].html5controls,true); -->

				<!-- 타임 라인 길이 -->
				calc(layer[time_linGV].width, layer[videoplayer_video].pixelwidth - 180);
				set(min_schet,60);
				set(minut_v_sm,0);

				set(layer[play_icon_video].visible, true);
				set(layer[videoplayer_video].onvideoplay,set(layer[play_icon_video].visible, false); set(layer[skin_playpause].crop,'64|640|64|64'););
				set(layer[videoplayer_video].onvideopaused,set(layer[play_icon_video].visible, true); set(layer[skin_playpause].crop,'0|640|64|64'); );

				copy(layer[videoplayer_video].pausedonstart, false);

				set(layer[close_video].parent, videoplayer_video);
				set(layer[close_video].alpha, 0.6);
				set(layer[close_video].enabled, true);
				set(layer[close_video].width, 20);



				if(device.flash,
					set(layer[videoplayer_video].url,'%CURRENTXML%/plugins/videoplayer.swf');
				  ,
					set(layer[videoplayer_video].url,'%CURRENTXML%/plugins/videoplayer.js');

				  );

				);
		  );
		<!-- 0601수정_영상 재생 시 자동 회전 멈춤, 배경음 멈춤. 이하 동일 -->
		autorotate.pause();
		if(tour_soundson,	pausesound(bgm););
	</action>

	<action name="videoplayer_ready_video">
		if(layer[videoplayer_video],
			set(events[videoplayer_events].onresize, videoplayer_resize_video() );
			copy(layer[videoplayer_video].pausedonstart, false);
			set(layer[videoplayer_video].onvideoready,
					videoplayer_resize_video();
					tween(scale,1,0.5,easeOutBack);
					tween(alpha,1,0.5,default, ifnot(device.ios, play() ) );

					position_slider_vid_addhs();
					set(layer[blok_GV].parent,videoplayer_video);

					set(layer[blok_GV].height,30);
					set(layer[blok_GV].alpha,1);

					set(layer[volumePanGLV].parent,videoplayer_video);
					volumectrl_updateGV();
			   );
			layer[videoplayer_video].playvideo(%1);
		  );

	</action>


	<!-- 비디오 크기 설정 -->
	<action name="videoplayer_resize_video">
		<!-- use 90% width or height of available screen size -->
		div(aspect, layer[videoplayer_video].imagewidth, layer[videoplayer_video].imageheight);
		mul(new_videowidth, stagewidth, get(width_vsm));
		div(new_videoheight, new_videowidth, aspect);
		mul(max_videoheight, stageheight,get(height_vsm));
		if(new_videoheight GT max_videoheight,
			copy(new_videoheight, max_videoheight);
			mul(new_videowidth, new_videoheight, aspect);
		  );
		roundval(new_videowidth);
		roundval(new_videoheight);
		copy(layer[videoplayer_video].width, new_videowidth);
		copy(layer[videoplayer_video].height, new_videoheight);
	</action>

	<action name="videoplayer_close_video">

		set(events.[videoplayer_events].name, null);
		if(layer[videoplayer_video], layer[videoplayer_video].pause() );
		set(layer[bg_video_frame].onclick, null);

		tween(layer[videoplayer_video].scale, 0.0, 0.5, easeInBack);
		tween(layer[bg_video_frame].alpha, 0.0, 0.5, default,
													removelayer(videoplayer_video);
													removelayer(bg_video_frame);
		    );
		set(layer[blok_GV].height,0);
		set(layer[blok_GV].alpha,0);

		set(layer[close_video].alpha, 0);
		set(layer[close_video].enabled, false);
		delayedcall(0.01,set(layer[play_icon_video].visible, false););

		if(pauza_open_okno,resumesound(sound););	<!-- 오디오를 재생하는 경우-오디오 핫스팟 재생 -->
		autorotate.resume();
		if(tour_soundson,	resumesound(bgm););

	</action>


	<!-- 닫기 버튼 -->
	<layer name="close_video"  keep="true" align="righttop" x="23"  y="23" url="%CURRENTXML%/source/common/btn/close.png" zorder="60"
	        width="20" height="prop" alpha="0" edge="center" visible="true" bgcapture="true" handcursor="true"
	        onover="tween(width,25,0.2);"
			onout="tween(width,20,0.2);"
			onclick="delayedcall(0.3,videoplayer_close_video();); tween(alpha,0); set(enabled,false); "
			/>


	<!-- 재생 버튼 -->
	<layer name="play_icon_video"  keep="true" align="center"  url="%CURRENTXML%/source/common/btn/btn_videoplay.png" zorder="100" enabled="false" visible="false" scale="0.7"
	        width="100" height="prop" alpha="1" edge="center" bgcapture="false" handcursor="false"
			/>



  	<!-- 텍스트 스타일 -->
	<style name="vremya_addhs" enabled="false"   url="%SWFPATH%/plugins/textfield.swf" css="font-family:Arial; color:#FFFFFF; font-size:11px;"
		    padding="3 7" keep="true" align="lefttop" background="false" backgroundcolor="0x2D3E50" backgroundalpha="0.7"
			textshadow="0.0" textshadowrange="4.0" textshadowangle="45" textshadowcolor="0x000000" textshadowalpha="1.0"
			wordwrap="false"
		  />



 <layer name="blok_GV" type="container" keep="true"  alpha="1" bgcolor="0x2D3E50" bgalpha="0.6"  align="leftbottom" width="100%" height="" maskchildren="true" handcursor="false" >

	<!-- 일시 정지 -->
    <layer name="skin_playpause" keep="true" url="%CURRENTXML%/source/common/btn/vtourskin.png" crop="64|640|64|64"  x="10" y="5" scale="0.3" alpha="0.5"
	       onclick="layer[videoplayer_video].togglepause();" />

	<!-- 볼륨 -->
	<layer name="volumeGV" keep="true"  type="container" width="32" height="32"  x="40" y="5" alpha="0.5"
		   bgcapture="true" children="false"
		   onover="tween(alpha,1); stopdelayedcall(skin_autohide);stopdelayedcall(autoclose_volumectrl); open_volumGL();"
		   onout="tween(alpha,0.5); if(layer[volumePanGLV].pressed == false, delayedcall(autoclose_volumectrl, 0.5, close_volumeGV()); );"
		   ondown="if(layer[volumePanGLV].alpha == 1.0, if(plugin[videoplayer_video].volume GT 0.0, set(plugin[videoplayer_video].volume,0.0)
													   , set(plugin[videoplayer_video].volume,1.0)); volumectrl_updateGV();
					   );"

		>
			<layer name="volume_begGV" keep="true" url="%CURRENTXML%/source/common/btn/vtourskin.png " crop="64|704|64|64" scale="0.3" align="lefttop" />
	</layer>

	<!-- 시간 -->
	<layer 	name="vremya_video" keep="true" align="righttop" url="%SWFPATH%/plugins/textfield.swf" css="font-family:Arial; color:#FFFFFF; font-size:13px;" enabled="false"  x="4" y="5" html=""
			background="false" padding="3 7" textshadow="0.0" textshadowrange="4.0" textshadowangle="45" textshadowcolor="0x000000" textshadowalpha="1.0"
			onclick="" />


  <!-- **************************  재생 타임 라인 ********************************* -->

	<layer name="time_linGV" type="container"  keep="true"  align="left"  height="5" width="80%" x="75" y="0" visible="true"  enabled="true"
	        bgcapture="true" bgcolor="0x767676" bgalpha="0.8" bgroundedge="2" bgshadow="2 2 4 0x000000 0.5" zorder="55"
		   onover="tween(height,10,0.1);tween(layer[sharik_vid1].alpha,1,0.1);"
		   onout="tween(height,5,0.3);tween(layer[sharik_vid1].alpha,0.8,0.1);"
		   ondown="scrab_liniya();"
		   >

		<!--  Runner ,ondown="copy(drag_currentx,x); copy(drag_stagex,mouse.stagex); dragging_begGV(time_linGV,timeGlV,totaltimeGLV);" -->
		<layer 	name="time_indikGV" type="container" keep="true"  bgcapture="false"  width="" height="100%" x="0" align="left"
				bgcolor="0x03b610" bgalpha="0.4"  bgroundedge="2" bgshadow="2 2 4 0x000000 0.5"  zorder="12"  >
			<!-- Ball -->
			<layer name="sharik_vid1" type="container" keep="true" align="right"  alpha="0.8" edge="center"  enabled="false"
					bgcapture="false"  width="12" height="12" bgcolor="0xFFFFFF" bgalpha="1"  bgroundedge="10" bgshadow="2 2 4 0x000000 0.5"  zorder="12"/>

		</layer>
	</layer>

 </layer>

	<!-- kursor_click - 스크롤바에 대한 x 좌표 -->
 	<action name="scrab_liniya">

	if(layer[videoplayer_video].ispaused, copy(pauza_add_V_hs,layer[videoplayer_video].ispaused););

	asyncloop(pressed,
						calc(kursor_click,mouse.stagex - (stagewidth / 2 - (layer[videoplayer_video].pixelwidth / 2) + layer[time_linGV].x ));
						calc(procent_t_lin,(kursor_click / layer[time_linGV].pixelwidth * 100) +'%');
						layer[videoplayer_video].seek(get(procent_t_lin));
						,
						if(pauza_add_V_hs,,layer[videoplayer_video].play(););
			 );
	</action>


     <!-- ********************************* 볼륨 컨트롤 패널 *************************************** -->

	<layer 	name="volumePanGLV" keep="true" type="container" align="leftbottom" width="20" height="110" x="40" y="35"  alpha="0.0" enabled="false" parent=""
			bgcolor="0x2D3E50" bgalpha="0.4" bgborder="" bgroundedge="1" bgshadow="2 2 4 0x000000 0.3" bgcapture="true"
			onover="stopdelayedcall(autoclose_volumectrl); "
			onout="if(pressed == false, delayedcall(autoclose_volumectrl, 0.5, close_volumeGV()); );"
			ondown="stopdelayedcall(autoclose_volumectrl); volume_ondownGV();"
			onup="onout();">

		<layer name="polosa_begGL" type="container" bgcolor="0xFFFFFF" bgalpha="0.25" align="center" width="4" height="-32">
				<!-- Бегунок -->
				<layer name="begun_GLV" type="container"  align="top" edge="center" x="0" bgroundedge="8" width="10" height="10"
					   bgcolor="0xFFFFFF" bgalpha="1.0" bgshadow="2 2 4 0x000000 0.3"/>
		</layer>

	</layer>

	<action name="open_volumGL">
		if(volumectrl_openedGL !== true,
			set(volumectrl_openedGL, true);
			tween(layer[volumePanGLV].alpha, 1.0, 0.2);
			set(layer[volumePanGLV].parent,videoplayer_video);
			set(layer[volumePanGLV].enabled,true);
		  );
	</action>

	<action name="close_volumeGV">
		if(volumectrl_openedGL === true,
			set(volumectrl_openedGL, false);
			tween(layer[volumePanGLV].alpha, 0.0, 0.2);
			set(layer[volumePanGLV].enabled,false);
		  );
	</action>

	<action name="volumectrl_updateGV">
		calc(layer[begun_GLV].y, ((1.0 - plugin[videoplayer_video].volume) * 100) + '%');
		calc(layer[volume_begGV].crop, plugin[videoplayer_video].volume GT 0.0 ? '64|704|64|64' : '64|704|40|64');
		calc(layer[volume_begGV].alpha, plugin[videoplayer_video].volume GT 0.0 ? 1.0 : 1.0);
	</action>

	<action name="volume_ondownGV">
		asyncloop(pressed,
						screentolayer(polosa_begGL, mouse.stagex,mouse.stagey, lx,ly);
						calc(volumectrl_pos, 1.0 - (ly / layer[polosa_begGL].pixelheight));
						clamp(volumectrl_pos, 0.0, 1.0);
						copy(plugin[videoplayer_video].volume, volumectrl_pos);
						volumectrl_updateGV();
						delete(lx, ly, volumectrl_pos);
				  );
	</action>

	<!-- ////////////////////// 비디오 슬라이더 드래그 (슬라이더 아래의 컨테이너, 변수, 최대 값), /////////////////////////////// -->
	<action name="dragging_begGV">
		    if(pressed,copy(newx1,newx);
						sub(dx, mouse.stagex, drag_stagex);
						add(newx, drag_currentx, dx);
						if(newx LT 0, set(newx,0));
						if(newx GT layer[%1].pixelwidth, copy(newx,layer[%1].pixelwidth));
						copy(x,newx);
						div(val, newx, layer[%1].pixelwidth);
						delayedcall(0,dragging_begGV(%1,%2,%3););
						mul(%2,val,%3);
						,
						plugin[videoplayer_video].seek(%2);
				);
	 </action>

<!-- ********************* 슬라이더를 클릭  scope="local" **************************************************** -->

	<action name="position_slider_vid_addhs" >
			copy(totaltimeGLV,plugin[videoplayer_video].totaltime);
			copy(timeGLV,plugin[videoplayer_video].time);                     	<!-- 변수 슬라이더를 레이어 매개 변수 값으로 설정 -->

			calc(val,layer[time_linGV].pixelwidth / totaltimeGLV * timeGLV);  	<!-- 컨테이너 길이 / 총 시간 * 현재 시간 -->

	    	set(layer[time_indikGV].width, get(val));                   		<!-- 슬라이더 설치  -->

			mod(sek_v_sm,get(timeGLV),60);									<!-- sek_v_sm - 타이머에서 60 초  timeGLV  -->
			roundval(sek_v_sm);

			if(sek_v_sm GE 60, set(sek_v_sm,0));

			calc(minut_v_sm,plugin[videoplayer_video].time / 60);
			Math.floor(minut_v_sm);											<!-- 내림차순으로 다음으로 낮은 정수 값을 계산. -->

			calc(totaltimeGLV2,totaltimeGLV / 60 );							<!-- 분 찾기 -->
			Math.floor(total_min,totaltimeGLV2);							<!-- 내림차순으로 다음으로 낮은 정수 값을 계산. -->
			calc(totalsec,(totaltimeGLV2 - total_min) * 60 );				<!-- 초 찾기. -->
			roundval(totalsec);

			calc(layer[vremya_video].html, minut_v_sm + ':' + (sek_v_sm LT 10 ? '0' : '') + sek_v_sm + ' / ' + total_min + ':' + (totalsec LT 10 ? '0' : '') + totalsec);

			if(layer[videoplayer_video],delayedcall(0,position_slider_vid_addhs(););, set(min_schet|minut_v_sm,60|0)); <!-- 슬라이더 설치  -->
	</action>


</krpano>
