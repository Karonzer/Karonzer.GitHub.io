<krpano popupName = "" currentPopUpIndex = "" popupImageCount = "">

  <!-- Web -->
  <!-- 팝업 부모 레이어, 배경 레이어 -->
  <layer name="layer_parent" type="image" alpha="0.0" zorder="20" align="center" onclick="layer_off();" visible="false" keep="true" />
  <layer name="layer_bg" type="container" width="100%" height="100%" alpha="1.0" bgcapture="true" zorder="15" align="center" bgcolor="0x000000" bgalpha="0.7" onclick="layer_off();" visible="false" keep="true" enabled="true" />

  <!-- popup layers -->
  <layer name="popup_bg" type="container" width="100%" height="100%" alpha="1.0" bgcapture="true" zorder="15" align="center" bgcolor="0x000000" bgalpha="0.7" onclick="close_popup();" visible="false" keep="true" enabled="true" />
  <layer name="popup" type="image" alpha="0.0" zorder="20" align="center" onclick="close_popup();" visible="false" keep="true" scalechildren="true" x="4" scale = "0.90"/>
  <layer name="popup_soundOn" url="%FIRSTXML%/source/common/btn/btn_sound_off.png" keep="true" parent="popup" align="lefttop" edge="bottom" handcursor="true" x="130" y="610" zorder="10" onclick="play_voice();" alpha="0.0" visible ="false" />
  <layer name="popup_soundOff" url="%FIRSTXML%/source/common/btn/btn_sound_on.png" keep="true" parent="popup" align="lefttop" edge="bottom" handcursor="true" x="130" y="610" zorder="10" onclick="stop_voice();" visible ="false" />
  <layer name="popup_btn_left" url="%FIRSTXML%/source/common/btn/btn_popup_left.png" keep="true" parent="popup" align="left" edge="middle" handcursor="true"  zorder="5" x ="-18" onclick="change_popup(left);" alpha="0.0" visible ="false" />
  <layer name="popup_btn_right" url="%FIRSTXML%/source/common/btn/btn_popup_right.png" keep="true" parent="popup" align="right" edge="middle" handcursor="true" zorder="5" x ="-10" onclick="change_popup(right);" alpha="0.0" visible ="false" />

  <!-- open popup -->
  <action name="open_popup">
    set(popupName, %1);
    set(currentPopUpIndex, 1);
    if(%2 != null, set(popupImageCount, %2);
      , set(popupImageCount, 1);
    );
  	set(layer[popup].url, calc: "source/"+ currentscene + "/popup/" + popupName + "_" + currentPopUpIndex + ".png");
  	set(voicepath, calc: currentscene + "/audio/" + popupName + "_" + currentPopUpIndex + ".mp3|" + popupName + "_" + currentPopUpIndex +".ogg");
  	Playeffect("bubble");
  	popup_size();
  	delayedcall(0.1, set(layer[popup_bg].visible,true));
  	delayedcall(0.1, tween(layer[popup_bg].alpha,  1.0, 0.3));
  	delayedcall(0.1, set(layer[popup].visible,true));
  	delayedcall(0.1, tween(layer[popup].alpha,  1.0, 0.3));
  	delayedcall(0.1, set(layer[popup_soundOn].visible,true));
  	delayedcall(0.1, tween(layer[popup_soundOn].alpha,  1.0, 0.3));
    if(currentPopUpIndex == popupImageCount,
      delayedcall(0.1, set(layer[popup_btn_left].visible,false));
      delayedcall(0.1, set(layer[popup_btn_right].visible,false));
    ,
    delayedcall(0.1, set(layer[popup_btn_left].visible,false));
    delayedcall(0.1, set(layer[popup_btn_right].visible,true));
    delayedcall(0.1, tween(layer[popup_btn_right].alpha,  1.0, 0.3));
    );

  	autorotate.pause();
  </action>

  <!-- open popup -->
  <action name="change_popup">
    set(layer[popup].alpha,  0.0);
  	set(layer[popup].visible,false);
    stop_voice();
  	set(layer[popup_soundOn].alpha,  0.0);
  	set(layer[popup_soundOn].visible,false);

    if(%1 == "right", inc(currentPopUpIndex);
    delayedcall(0.1, set(layer[popup_btn_left].visible,true));
    delayedcall(0.1, tween(layer[popup_btn_left].alpha,  1.0, 0.3));
    if(currentPopUpIndex == popupImageCount,
    delayedcall(0.1, set(layer[popup_btn_right].visible,false));  );
    , dec(currentPopUpIndex);
    delayedcall(0.1, set(layer[popup_btn_right].visible,true));
    delayedcall(0.1, tween(layer[popup_btn_right].alpha,  1.0, 0.3));
    if(currentPopUpIndex == 1,
    delayedcall(0.1, set(layer[popup_btn_left].visible,false));  );
    );

    set(layer[popup].url, calc: "source/"+ currentscene + "/popup/" + popupName + "_" + currentPopUpIndex + ".png");
  	set(voicepath, calc: currentscene + "/audio/" + popupName + "_" + currentPopUpIndex + ".mp3|" + popupName + "_" + currentPopUpIndex +".ogg");
    Playeffect("bubble");
    popup_size();
    delayedcall(0.1, set(layer[popup_bg].visible,true));
    delayedcall(0.1, tween(layer[popup_bg].alpha,  1.0, 0.3));
    delayedcall(0.1, set(layer[popup].visible,true));
    delayedcall(0.1, tween(layer[popup].alpha,  1.0, 0.3));
    delayedcall(0.1, set(layer[popup_soundOn].visible,true));
    delayedcall(0.1, tween(layer[popup_soundOn].alpha,  1.0, 0.3));

    autorotate.pause();
  </action>

  <!-- set up popup size -->
  <action name="popup_size">
  	set(layer[popup].width, 1000);
  	set(layer[popup].height, 909);
  	calc(popupratio, layer[popup].width/layer[popup].height);
  	if( stagewidth/stageheight GE popupratio,
  		calc(layer[popup].height, stageheight);
  		calc(layer[popup].width, layer[popup].height * popupratio);

  		, calc(layer[popup].width, stagewidth);
  		calc(layer[popup].height, layer[popup].width / popupratio);


  	);
  </action>

  <!-- close popup -->
  <action name="close_popup">
  	set(layer[popup_bg].alpha,  0.0);
  	set(layer[popup_bg].visible,false);
  	set(layer[popup].alpha,  0.0);
  	set(layer[popup].visible,false);
  	stop_voice();
  	set(layer[popup_soundOn].alpha,  0.0);
  	set(layer[popup_soundOn].visible,false);
  	autorotate.resume();
  </action>

  <!-- VR -->

  <!-- vr description hotspot style -->
  <style name="btn_description_vr" url="%FIRSTXML%/source/common/btn/btn_description.png" scale="0.40" zorder="1" zoom="false" distorted="false" visible="false" />
  <style name="popup_window_vr" zorder="2" zoom="false" distorted="true" handcursor="false" visible="false" scale="0.5" />
  <style name="popup_close_btn_vr" url="%FIRSTXML%/source/common/commonmap/commonmap_spot.png" zorder="3" zoom="false" scale="0.25" visible ="false" />
  <style name="popup_soundOn_vr" url="%FIRSTXML%/source/common/btn/btn_sound_off.png" zorder="3" onclick="play_voice_vr();" zoom="false" scale="0.25" visible ="false" />
  <style name="popup_soundOff_vr" url="%FIRSTXML%/source/common/btn/btn_sound_on.png" zorder="3" onclick="stop_voice_vr();" zoom="false" scale="0.25" visible ="false" />
  <style name="popup_btn_left_vr" url="%FIRSTXML%/source/common/btn/btn_popup_left.png" zorder="3" onclick="change_popup_vr(left);" zoom="false" scale="0.25" visible ="false" />
  <style name="popup_btn_right_vr" url="%FIRSTXML%/source/common/btn/btn_popup_right.png" zorder="3" onclick="change_popup_vr(right);" zoom="false" scale="0.25" visible ="false" />

  <!-- open vr mode popup -->
  <action name="open_popup_vr">
    set(popupName, %1);
    set(currentPopUpIndex, 1);
    if(%2 != null, set(popupImageCount, %2);
      , set(popupImageCount, 1);
    );
  	set(hotspot[popup_vr].url, calc: "source/"+ currentscene + "/popup/" + popupName + "_" + currentPopUpIndex + ".png");
    set(voicepath, calc: currentscene + "/audio/" + popupName + "_" + currentPopUpIndex + ".mp3|" + popupName + "_" + currentPopUpIndex +".ogg");
  	Playeffect("bubble");
  	set(popupvr, calc: "%1" + "_vr");
  	set(hotspot[popup_vr].ath, get(hotspot[get(popupvr)].ath));

  	set(hotspot[popup_close_btn_vr].ath, get(calc(hotspot[get(popupvr)].ath + 20)));
  	set(hotspot[popup_soundOn_vr].ath, get(calc(hotspot[get(popupvr)].ath - 20)));
  	set(hotspot[popup_soundOff_vr].ath, get(calc(hotspot[get(popupvr)].ath - 20)));

    set(hotspot[popup_btn_left_vr].ath, get(calc(hotspot[get(popupvr)].ath - 30)));
    set(hotspot[popup_btn_right_vr].ath, get(calc(hotspot[get(popupvr)].ath + 30)));

  	set(hotspot[popup_vr].visible,true);
  	set(hotspot[popup_close_btn_vr].visible,true);

    if(currentPopUpIndex == popupImageCount,
      set(hotspot[popup_btn_left_vr].visible,false);
      set(hotspot[popup_btn_right_vr].visible,false);
    ,
      set(hotspot[popup_btn_left_vr].visible,false);
      set(hotspot[popup_btn_right_vr].visible,true);
    );


  	set(layer[popup_soundOff_vr].visible,true);
  	play_voice_vr();
  </action>

  <action name="change_popup_vr">
    stop_voice_vr();
    if(%1 == "right", inc(currentPopUpIndex);
      set(hotspot[popup_btn_left_vr].visible,true);

    if(currentPopUpIndex == popupImageCount,
      set(hotspot[popup_btn_right_vr].visible,false); );
    ,
      dec(currentPopUpIndex);
      set(hotspot[popup_btn_right_vr].visible,true);

      if(currentPopUpIndex == 1,
      set(hotspot[popup_btn_left_vr].visible,false);  );
    );

    set(hotspot[popup_vr].url, calc: "source/"+ currentscene + "/popup/" + popupName + "_" + currentPopUpIndex + ".png");
    set(voicepath, calc: currentscene + "/audio/" + popupName + "_" + currentPopUpIndex + ".mp3|" + popupName + "_" + currentPopUpIndex +".ogg");
    Playeffect("bubble");

    set(hotspot[popup_vr].visible,true);
    set(hotspot[popup_close_btn_vr].visible,true);
    set(layer[popup_soundOff_vr].visible,true);
    play_voice_vr();
  </action>

  <!-- close popup -->
  <action name="close_popup_vr">
  	stop_voice_vr();
    set(hotspot[popup_vr].visible,false);
  	set(hotspot[popup_close_btn_vr].visible,false);
    set(hotspot[popup_soundOn_vr].visible,false);
    set(hotspot[popup_soundOff_vr].visible,false);
    set(hotspot[popup_btn_left_vr].visible,false);
    set(hotspot[popup_btn_right_vr].visible,false);
  	autorotate.resume();
  </action>

  <!-- popup vr off if visible is true -->
  	<action name="popup_vr_off">
    <!-- 		stopsound("recodingVoice"); -->
  		if(hotspot[popup_vr].visible == true,
  				close_popup_vr();
  		);
  	</action>


</krpano>
